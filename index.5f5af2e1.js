var t,e;class i{static{this.idCounter=0}static{this.entities=[]}constructor(t,e,s,o){this.id="",this.position={x:0,y:0},this.rotation=0,this.mass=1,this.size={x:1,y:1},this.velocity={x:0,y:0},this.orbitPoints=[],this.tasks={},this.id=`e-${i.idCounter++}`,t&&(this.position=t),e&&(this.rotation=e),s&&(this.size=s),o&&(this.velocity=o),this.renderOrbit=this.renderOrbit.bind(this),i.entities.push(this)}simulateTrajectory(){}destroy(){i.entities=i.entities.filter(t=>t.id!==this.id)}update(t){}render(t){}renderOrbit(t,e="rgba(255, 255, 255, 0.3)"){let{ctx:i,eScreenPosition:s}=t;if(i.strokeStyle=e,i.beginPath(),i.moveTo(s.x,s.y),this.orbitPoints.forEach(e=>{let s=(e.x-t.cameraPosition.x)*t.cameraSize+t.canvas.width/2,o=(t.cameraPosition.y-e.y)*t.cameraSize+t.canvas.height/2;i.lineTo(s,o)}),i.stroke(),this.orbitPoints.length<5e3){let e=this.orbitPoints[this.orbitPoints.length-1],s=(e.x-t.cameraPosition.x)*t.cameraSize+t.canvas.width/2,o=(t.cameraPosition.y-e.y)*t.cameraSize+t.canvas.height/2;i.strokeStyle="#F00",i.lineWidth=2,i.beginPath(),i.moveTo(s-5,o-5),i.lineTo(s+5,o+5),i.moveTo(s-5,o+5),i.lineTo(s+5,o-5),i.stroke()}}}class s{static{this.mousePosition={x:0,y:0}}static{this.mouseButtons={}}static{this.keys={}}static{this.mouseClickFlags={}}static{this.keyClickFlags={}}static init(t){window.addEventListener("mousemove",s.onMouseMove),window.addEventListener("mousedown",s.onMouseDown,!1),window.addEventListener("mouseup",s.onMouseUp,!1),window.addEventListener("keydown",s.onKeyDown,!1),window.addEventListener("keyup",s.onKeyUp,!1)}static update(){s.mouseClickFlags={...s.mouseButtons},s.keyClickFlags={...s.keys}}static isKeyDown(t){return s.keys[t]}static isKeyPressed(t){return s.keys[t]&&!s.keyClickFlags[t]}static isMouseDown(t){return s.mouseButtons[t]}static isMousePressed(t){return s.mouseButtons[t]&&!s.mouseClickFlags[t]}static onMouseMove(t){s.mousePosition={x:t.clientX,y:t.clientY}}static onMouseDown(t){s.mouseButtons[t.button]=!0}static onMouseUp(t){s.mouseButtons[t.button]=!1}static onKeyDown(t){s.keys[t.key]=!0}static onKeyUp(t){s.keys[t.key]=!1}}class o extends i{update(t){let e=t/.02*2;if(null!==this.orbitBody){let t=this.position.x-this.orbitBody.position.x,i=this.position.y-this.orbitBody.position.y,s=Math.sqrt(t**2+i**2),o=this.orbitBody.mass/s**2;this.velocity.x-=t/s*o*.02*e,this.velocity.y-=i/s*o*.02*e}this.position.x+=.02*this.velocity.x*e,this.position.y+=.02*this.velocity.y*e,this.simulateTrajectory()}render(t){let{ctx:e,eScreenPosition:i,eScreenSize:s}=t;this.orbitPoints.length>0&&this.renderOrbit(t),e.strokeStyle="white",e.fillStyle="white",e.beginPath(),e.arc(i.x,i.y,s.x,0,2*Math.PI),e.stroke(),e.fill(),this.tasks.orbit&&this.renderHalo(t,this.tasks.orbit)}renderHalo(t,e){let{ctx:i}=t,s=Date.now()/1e4%(2*Math.PI);i.strokeStyle=e.enterTime?"#383":"#555",i.setLineDash([2,5]),i.beginPath();let o=(this.position.x-t.cameraPosition.x)*t.cameraSize+t.canvas.width/2,a=(t.cameraPosition.y-this.position.y)*t.cameraSize+t.canvas.height/2,n=t.cameraSize*e.radius;i.arc(o,a,n,s,s+2*Math.PI),i.stroke(),i.setLineDash([])}simulateTrajectory(){let t=[],e={x:this.velocity.x,y:this.velocity.y},i={x:this.position.x,y:this.position.y};for(let s=0;s<5e3;s++)if(this.orbitBody){let o=this.orbitBody.orbitPoints[s].x-i.x,a=this.orbitBody.orbitPoints[s].y-i.y,n=Math.sqrt(o**2+a**2),r=this.orbitBody.mass/n**2,l=o/n*r,c=a/n*r;e.x+=.02*l,e.y+=.02*c,i.x+=.02*e.x,i.y+=.02*e.y,t.push({x:i.x,y:i.y})}else t.push({x:i.x,y:i.y});this.orbitPoints=t}constructor(...t){super(...t),this.orbitBody=null}}class a extends i{pointDirection(t,e){let i=180*Math.atan2(this.velocity.x*t,this.velocity.y*t)/Math.PI-this.rotation;i>180?i-=360:i<-180&&(i+=360);let s=Math.sign(i)*Math.min(Math.abs(i),120*e);this.rotation+=s}update(e){let a=e/.02*2;if(i.entities.forEach(t=>{if(t instanceof o){let e=t.position.x-this.position.x,i=t.position.y-this.position.y,s=Math.sqrt(e**2+i**2),o=t.mass/s**2;this.velocity.x+=e/s*o*.02*a,this.velocity.y+=i/s*o*.02*a}}),c.state===t.GAME){if(s.isKeyDown("ArrowLeft")||s.isKeyDown("a")?this.rotation-=120*e:(s.isKeyDown("ArrowRight")||s.isKeyDown("d"))&&(this.rotation+=120*e),s.isKeyDown(" ")){let t={x:Math.sin(Math.PI/180*this.rotation),y:Math.cos(Math.PI/180*this.rotation)};this.velocity.x+=1*t.x*.02*a,this.velocity.y+=1*t.y*.02*a}s.isKeyDown("s")?this.pointDirection(-1,e):s.isKeyDown("w")&&this.pointDirection(1,e)}for(let t of(this.position.x+=.02*this.velocity.x*a,this.position.y+=.02*this.velocity.y*a,i.entities))if(t instanceof o){let e=Math.sqrt((t.position.x-this.position.x)**2+(t.position.y-this.position.y)**2);if(e<t.size.x){c.endGame(!1);break}if(t.tasks)for(let i in t.tasks){let s=t.tasks[i];!s.completed&&"orbit"===i&&(e<s.radius?s.enterTime?Date.now()-s.enterTime>s.time&&(s.completed=!0):s.enterTime=Date.now():s.enterTime=void 0)}}this.rotation=this.rotation%360,this.simulateTrajectory()}render(t){let{ctx:e,eScreenPosition:i,eScreenSize:s}=t;this.renderOrbit(t,"rgba(255, 255, 255, 1)"),e.strokeStyle="white",e.fillStyle="white",e.save(),e.translate(i.x,i.y),e.rotate(Math.PI/180*this.rotation),e.beginPath(),e.moveTo(-s.x/2,s.y/2),e.lineTo(s.x/2,s.y/2),e.lineTo(0,-s.y/2),e.closePath(),e.fill(),e.stroke(),e.restore()}simulateTrajectory(){let t=[],e={x:this.velocity.x,y:this.velocity.y},s={x:this.position.x,y:this.position.y};for(let a=0;a<5e3;a++){let n=!1;for(let t of i.entities)if(t instanceof o){let i=t.position.x,o=t.position.y;t.orbitPoints.length>a&&(i=t.orbitPoints[a].x,o=t.orbitPoints[a].y);let r=i-s.x,l=o-s.y,c=Math.sqrt(r**2+l**2);if(c<t.size.x){n=!0;break}let h=t.mass/c**2,y=r/c*h,d=l/c*h;e.x+=.02*y,e.y+=.02*d}if(n)break;t.push({x:s.x,y:s.y}),s.x+=.02*e.x,s.y+=.02*e.y}this.orbitPoints=t}}const n=["levels/level1.json","levels/level2.json","levels/level3.json","levels/level4.json"];class r{static{this.currentLevel=null}constructor(t,e){this.path="",this.tasks=[],this.entities=[],this.path=t,this.rawData=e}destroy(){this.entities=[]}static load(e){i.entities=[],c.state=t.GAME,fetch(e).then(t=>t.json()).then(t=>{let s={},n=[];if(t.level.bodies.forEach(t=>{let e=new o(t.position,0,{x:t.radius,y:t.radius},t.velocity||{x:0,y:0});e.mass=t.mass,t.id&&(e.id=t.id),t.orbits&&(s[e.id]=t.orbits),t.tasks&&(e.tasks=t.tasks,Object.keys(t.tasks).forEach(i=>{t.tasks&&n.push({type:i,entity:e,data:t.tasks[i]})}))}),t.level.player){let e=t.level.player,i=new a(e.position||{x:0,y:0},e.rotation||0,{x:.5,y:.75});i.velocity=e.velocity||{x:0,y:0},i.rotation=e.rotation||0}Object.keys(s).forEach(t=>{let e=i.entities.find(e=>e.id===t);if(e){let o=i.entities.find(e=>e.id===s[t]);e.orbitBody=o}});let l=new r(e,t);l.tasks=n,r.currentLevel=l})}static renderLevelSelect(t){let{canvas:e,ctx:i}=t,s=30*n.length-5,o=(e.width-s)/2,a=e.height-35-10;i.font="12px monospace",i.fillStyle="white",i.textAlign="center",i.textBaseline="middle",n.forEach((t,e)=>{let s=o+30*e+5,n=a+5,r=(e+1).toString();i.strokeStyle="white",i.strokeRect(s,n,25,25),i.fillStyle="white",i.fillText(r,s+12.5,n+12.5)})}static onLevelSelectClick(t,e){let{canvas:i}=t,s=30*n.length-5,o=(i.width-s)/2,a=i.height-35-10;n.forEach((t,i)=>{let s=o+30*i+5,n=a+5;e.x>s&&e.x<s+25&&e.y>n&&e.y<n+25&&r.load(t)})}}class l{static renderTasks(t,e){let{ctx:i}=t,s=30;i.font="12px monospace",i.fillStyle="white",i.strokeStyle="white",i.textAlign="left",i.textBaseline="middle",e.forEach((t,e)=>{i.font="12px monospace";let o=function(t,e,i){for(var s=e.split(" "),o=[],a=s[0],n=1;n<s.length;n++){var r=s[n];t.measureText(a+" "+r).width<120?a+=" "+r:(o.push(a),a=r)}return o.push(a),o}(i,t.data.info,0),a=40+20*o.length*e;s+=20*o.length;for(let t=0;t<o.length;t++)i.fillText(o[t],15,a+15*t);if("orbit"===t.type){let e=t.data;if(e.completed)i.font="bold 18px monospace",i.fillText("âœ“",152,a+7);else if(e.enterTime){let t=Date.now()-e.enterTime,s=(e.time-t)/1e3,n=`${s.toFixed(1)}s`;i.fillText(n,145,a+o.length/2*15)}}}),i.beginPath(),i.strokeRect(10,10,170,s),i.fillText("Tasks",15,20),i.beginPath(),i.moveTo(10,30),i.lineTo(180,30),i.stroke(),i.beginPath(),i.moveTo(140,10),i.lineTo(140,10+s),i.stroke()}static renderFailScreen(t){let{canvas:e,ctx:i}=t;i.globalCompositeOperation="difference",i.fillStyle="white",i.font="bold 48px monospace",i.textAlign="center",i.textBaseline="middle",i.fillText("You died",e.width/2,e.height/2),i.font="24px monospace",i.fillText("Press R to restart",e.width/2,e.height/2+50),i.globalCompositeOperation="source-over"}static renderWinScreen(t){let{canvas:e,ctx:i}=t;i.globalCompositeOperation="difference",i.fillStyle="white",i.font="bold 48px monospace",i.textAlign="center",i.textBaseline="middle",i.fillText("You win",e.width/2,e.height/2),i.font="24px monospace",i.fillText("Press R to restart",e.width/2,e.height/2+50),i.globalCompositeOperation="source-over"}}(e=t||(t={}))[e.GAME=0]="GAME",e[e.FAILSCREEN=1]="FAILSCREEN",e[e.WINSCREEN=2]="WINSCREEN";class c{static{this.cameraPosition={x:0,y:0}}static{this.cameraSize=10}static{this.lastFrameTime=Date.now()}static{this.state=0}static init(){c.canvas=document.getElementById("orbits-canvas"),c.ctx=c.canvas.getContext("2d"),c.ctx.imageSmoothingEnabled=!1,c.ctx.imageSmoothingQuality="high",c.updateCanvasSize(),window.addEventListener("resize",c.updateCanvasSize),s.init(c.canvas),r.load("levels/level1.json"),c.update()}static updateCanvasSize(){c.canvas.width=window.innerWidth,c.canvas.height=window.innerHeight}static update(){let t=Date.now();for(let e of i.entities)e.update((t-c.lastFrameTime)/1e3);c.lastFrameTime=t,0===c.state&&r.currentLevel&&r.currentLevel.tasks.every(t=>t.data.completed)&&c.endGame(!0),c.render(),s.isKeyPressed("r")&&r.load(r.currentLevel?.path||"levels/level1.json");let e={cameraPosition:c.cameraPosition,cameraSize:c.cameraSize,canvas:c.canvas,ctx:c.ctx};s.isMousePressed(0)&&r.onLevelSelectClick(e,s.mousePosition),s.update(),requestAnimationFrame(c.update)}static render(){c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height);let t={cameraPosition:c.cameraPosition,cameraSize:c.cameraSize,canvas:c.canvas,ctx:c.ctx};switch(i.entities.forEach(e=>e.render({...t,eScreenPosition:{x:(e.position.x-c.cameraPosition.x)*c.cameraSize+c.canvas.width/2,y:(c.cameraPosition.y-e.position.y)*c.cameraSize+c.canvas.height/2},eScreenSize:{x:e.size.x*c.cameraSize,y:e.size.y*c.cameraSize}})),c.state){case 0:r.currentLevel&&l.renderTasks({cameraPosition:c.cameraPosition,cameraSize:c.cameraSize,canvas:c.canvas,ctx:c.ctx},r.currentLevel.tasks);break;case 1:l.renderFailScreen(t);break;case 2:l.renderWinScreen(t)}r.renderLevelSelect(t)}static endGame(t){if(0===c.state&&(c.state=t?2:1),!t){let t=i.entities.find(t=>t instanceof a);t&&t.destroy()}}}window.addEventListener("load",c.init);
//# sourceMappingURL=index.5f5af2e1.js.map
